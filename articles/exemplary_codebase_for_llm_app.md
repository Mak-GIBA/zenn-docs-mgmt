---
title: "[DeepResearch]LLMアプリケーションの模範的な設計を知りたい"
emoji: "🙌"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: 
  - "deep learning"
  - "llm"
  - "オブジェクト指向"
  - "設計"
  - "langchain"
  - "プログラミング"
  - "deep research"
published: true
---

LLMアプリケーションを作ろうと思ったときに，プログラムをどんな感じで設計しようか迷いませんか？(ディレクトリどんな感じで切るかとか)。特に，私は職業柄実用的なアプリケーションのシステム設計には弱いので，プログラムを設計する際に参考になるようなコードベースをDeepResearchにを調査してもらいました。
以下回答です。


___
# LangChainを用いたRAG検索・エージェント・チャットボットの模範コードベース

LangChainフレームワークを使って**RAG**（Retrieval Augmented Generation）検索、**エージェント**（ツール使用による動的推論）、**チャットボット**対話機能を組み合わせたLLMアプリケーションの代表的なオープンソースプロジェクトを紹介します。それぞれPythonで構築されており、機能ごとにモジュール化された洗練された設計が特徴です。

## GPT-4 & LangChain PDFチャットボット（mayooear/gpt4-pdf-chatbot-langchain）

**GPT-4 & LangChain Chatbot for Large PDF**は、大規模なPDFドキュメントに対する質問応答チャットボットのテンプレート実装です ([GitHub - mayooear/ai-pdf-chatbot-langchain: AI PDF chatbot agent built with LangChain & LangGraph](https://github.com/mayooear/gpt4-pdf-chatbot-langchain#:~:text=AI%20PDF%20Chatbot%20%26%20Agent,Powered%20by%20LangChain%20and%20LangGraph))。Next.js（TypeScript）によるフロントエンドとLangChain（Python）バックエンドを含むモノレポ構成で、ユーザがアップロードしたPDF等の文書を**埋め込みベクトル**に変換してSupabaseなどのベクトルDBに格納し、対話時に関連部分を検索してGPT-4などのLLMに与えて回答を生成します ([GitHub - mayooear/ai-pdf-chatbot-langchain: AI PDF chatbot agent built with LangChain & LangGraph](https://github.com/mayooear/gpt4-pdf-chatbot-langchain#:~:text=AI%20PDF%20Chatbot%20%26%20Agent,Powered%20by%20LangChain%20and%20LangGraph)) ([GitHub - mayooear/ai-pdf-chatbot-langchain: AI PDF chatbot agent built with LangChain & LangGraph](https://github.com/mayooear/gpt4-pdf-chatbot-langchain#:~:text=match%20at%20L486%205,if%20needed%29%20to%20answer))。LangChainの**DocumentLoader**や**テキスト分割**・**ベクトル格納**・**ConversationalRetrievalChain**などRAGに必要な一連のコンポーネントを備えており、LangGraphを用いたエージェント的な振る舞い（必要に応じ文書検索を行うチャットフロー）も組み込まれています ([GitHub - mayooear/ai-pdf-chatbot-langchain: AI PDF chatbot agent built with LangChain & LangGraph](https://github.com/mayooear/gpt4-pdf-chatbot-langchain#:~:text=AI%20PDF%20Chatbot%20%26%20Agent,Powered%20by%20LangChain%20and%20LangGraph)) ([GitHub - mayooear/ai-pdf-chatbot-langchain: AI PDF chatbot agent built with LangChain & LangGraph](https://github.com/mayooear/gpt4-pdf-chatbot-langchain#:~:text=5,if%20needed%29%20to%20answer))。フロントエンドからはREST API経由でバックエンドのLangChainエージェントを呼び出し、質問に関連する文書片を取得して回答する流れになっています ([GitHub - mayooear/ai-pdf-chatbot-langchain: AI PDF chatbot agent built with LangChain & LangGraph](https://github.com/mayooear/gpt4-pdf-chatbot-langchain#:~:text=match%20at%20L486%205,if%20needed%29%20to%20answer))。GitHubで15k以上のスターを獲得しており、RAG+チャットボット実装の事実上の標準例の一つです。また、このプロジェクトをベースに自社データ向けにカスタマイズすることで、ドキュメントQAチャットボットを迅速に構築できます。

## LangChain-Chatbot（Python実装、Haste171）

上記のPDFチャットボットを**Pythonのみで再実装**したのがHaste171氏の「LangChain-Chatbot」です ([GitHub - Haste171/langchain-chatbot: AI Chatbot for analyzing/extracting information from data in conversational format.](https://github.com/Haste171/langchain-chatbot#:~:text=The%20LangChain%20Chatbot%20was%20developed,Python%20from%20the%20Mayo%20chatbot))。TypeScript/Next.js環境を使わず、バックエンドからUIまでPythonで構築されているため、シンプルにローカルで動作させることができます。このリポジトリでは**エンドポイント（APIサーバ）**と**ハンドラ（質問応答処理）**、**UI**、**ユーティリティ**をディレクトリ毎に分離しており、機能ごとにモジュール化された明快な構成になっています ([GitHub - Haste171/langchain-chatbot: AI Chatbot for analyzing/extracting information from data in conversational format.](https://github.com/Haste171/langchain-chatbot#:~:text=endpoints))。例えば`handlers/`にドキュメント埋め込み・検索やチャット履歴管理などのロジック、`endpoints/`にFastAPIによるAPIルート、`ui/`にStreamlitベースの簡易フロントエンド（ファイルアップロードやチャット画面）を実装しています。主要機能として、**インタラクティブなファイル取り込みUI**（PDF等をアップロードしてインデックス化）と、**ソース参照付きのチャットUI**（応答に引用元ドキュメントを表示、温度やベクトル検索トップk件数などパラメータ調整可能）を備えています ([langchain-chatbot/README.md at main · Haste171/langchain-chatbot · GitHub](https://github.com/Haste171/langchain-chatbot/blob/main/README.md#:~:text=%E2%9C%85%20Interactive%20Ingestion%20UI%20for,files))。実行手順も整備されており、リポジトリをクローン後に```poetry install```で依存関係を導入し、```python3 startup.py```を起動するだけでローカルサーバが立ち上がります ([langchain-chatbot/README.md at main · Haste171/langchain-chatbot · GitHub](https://github.com/Haste171/langchain-chatbot/blob/main/README.md#:~:text=Setup)) ([langchain-chatbot/README.md at main · Haste171/langchain-chatbot · GitHub](https://github.com/Haste171/langchain-chatbot/blob/main/README.md#:~:text=match%20at%20L247%20Run%20Startup))。環境変数ファイル（`.env`）でOpenAI APIキーやベクトルDBのパスを設定するだけで動作し、設定次第でGPT-4などのOpenAIモデルを利用できます。※将来的にVicunaやAlpacaなど**オフラインLLM**への対応も計画されており ([langchain-chatbot/README.md at main · Haste171/langchain-chatbot · GitHub](https://github.com/Haste171/langchain-chatbot/blob/main/README.md#:~:text=%E2%9C%85%20More%20features%20coming%20very,soon))、拡張性も考慮された設計です。

## RAG Chatbot (Streamlit UI, 複数LLM対応) – AlaGrine/RAG_chatbot_with_Langchain

 ([GitHub - AlaGrine/RAG_chatabot_with_Langchain: A retrieval augmented generation chatbot  powered by  Langchain, Cohere, OpenAI, Google Generative AI and Hugging Face ](https://github.com/AlaGrine/RAG_chatabot_with_Langchain)) *RAGチャットボットのLangChainコンポーネント構成図。上段では文書のロード・分割・ベクトル埋め込みを行いChroma等のベクトルストアに保存します。下段ではユーザ質問に基づき関連情報を検索（Retriever）し、LLM APIで回答を生成するフローが示されています* ([GitHub - AlaGrine/RAG_chatabot_with_Langchain: A retrieval augmented generation chatbot  powered by  Langchain, Cohere, OpenAI, Google Generative AI and Hugging Face ](https://github.com/AlaGrine/RAG_chatabot_with_Langchain#:~:text=The%20aim%20of%20this%20project,up%20questions%20for%20accurate%20answers))　

AlaGrine氏のプロジェクトは、**Streamlit**による簡易なWeb UI上でRAGチャットボットを動作させる実装です。ユーザはテキスト、PDF、CSV、Docx形式のドキュメントをアップロードでき、内部でLangChainを使ってそれらをベクトルデータベース（デフォルトでは**Chroma**を使用）に格納します ([GitHub - AlaGrine/RAG_chatabot_with_Langchain: A retrieval augmented generation chatbot  powered by  Langchain, Cohere, OpenAI, Google Generative AI and Hugging Face ](https://github.com/AlaGrine/RAG_chatabot_with_Langchain#:~:text=The%20aim%20of%20this%20project,up%20questions%20for%20accurate%20answers))。質問に対してはアップロードされた関連文書を検索し、該当箇所をコンテキストとしてLLMに与えることで正確な回答を生成します ([GitHub - AlaGrine/RAG_chatabot_with_Langchain: A retrieval augmented generation chatbot  powered by  Langchain, Cohere, OpenAI, Google Generative AI and Hugging Face ](https://github.com/AlaGrine/RAG_chatabot_with_Langchain#:~:text=The%20aim%20of%20this%20project,up%20questions%20for%20accurate%20answers))。文書ローダーからベクトルストア、**ConversationalRetrievalChain**を用いた対話型QAまで、RAGシステムの各コンポーネントを一通り確認しやすい構成になっています ([GitHub - AlaGrine/RAG_chatabot_with_Langchain: A retrieval augmented generation chatbot  powered by  Langchain, Cohere, OpenAI, Google Generative AI and Hugging Face ](https://github.com/AlaGrine/RAG_chatabot_with_Langchain#:~:text=retrieved%20and%20sent%20to%20the,up%20questions%20for%20accurate%20answers))。UIはStreamlit上に実装されており、サイドバーからLLMプロバイダを選択（OpenAIのGPT-3.5/GPT-4、Google Generative AIのGemini、HuggingFaceのMistralモデル等）してAPIキーやプロンプトパラメータを設定できます ([GitHub - AlaGrine/RAG_chatabot_with_Langchain: A retrieval augmented generation chatbot  powered by  Langchain, Cohere, OpenAI, Google Generative AI and Hugging Face ](https://github.com/AlaGrine/RAG_chatabot_with_Langchain#:~:text=3,and%20insert%20your%20API%20keys))。例えばGPT-4（OpenAI API）からGoogleのPaLM2（Gemini）までワンクリックで切り替えて試すことが可能です ([GitHub - AlaGrine/RAG_chatabot_with_Langchain: A retrieval augmented generation chatbot  powered by  Langchain, Cohere, OpenAI, Google Generative AI and Hugging Face ](https://github.com/AlaGrine/RAG_chatabot_with_Langchain#:~:text=3,and%20insert%20your%20API%20keys))。セットアップもシンプルで、Python 3環境下で```pip install -r requirements.txt```実行後、```streamlit run RAG_app.py```コマンドで起動できます ([GitHub - AlaGrine/RAG_chatabot_with_Langchain: A retrieval augmented generation chatbot  powered by  Langchain, Cohere, OpenAI, Google Generative AI and Hugging Face ](https://github.com/AlaGrine/RAG_chatabot_with_Langchain#:~:text=1,and%20insert%20your%20API%20keys))。軽量ながらマルチベクトルDB・マルチLLMに対応しており、RAG＋チャットボットの全体像を学ぶのに適したリファレンス実装です。

## OpenGPTs（LangChainチーム提供の総合プラットフォーム）

LangChain開発チーム自らが公開している**OpenGPTs**は、OpenAIが提供する「カスタムGPT（Assistants）」機能に類似した**汎用LLMアシスタント構築プラットフォーム**です ([GitHub - langchain-ai/opengpts](https://github.com/langchain-ai/opengpts#:~:text=This%20is%20an%20open%20source,control%2C%20allowing%20you%20to%20configure))。バックエンドはLangChain/LangGraph/LangServe/LangSmithといったLangChainエコシステムを駆使したPythonサーバ、フロントエンドはNext.js製のWeb UIで構成されています。大きな特徴は構成要素の**柔軟な切り替えと組み合わせ**が可能な点で、使用するLLM（LangChain対応の60以上のモデルから選択）、プロンプトテンプレート（LangSmithでデバッグ可能）、与えるツール（100種類以上のLangChain組込ツールや独自ツールも追加可能）、ベクトルデータベース（60種以上の統合先に対応）、チャット履歴の保存先DBなどを自由に設定できます ([GitHub - langchain-ai/opengpts](https://github.com/langchain-ai/opengpts#:~:text=,chat%20history%20database%20you%20use))。さらに肝心の**認知アーキテクチャ**（LLMエージェントの思考フロー）も選択可能で、現時点で次の3種類のテンプレートが実装されています ([GitHub - langchain-ai/opengpts](https://github.com/langchain-ai/opengpts#:~:text=Cognitive%20Architecture)) ([GitHub - langchain-ai/opengpts](https://github.com/langchain-ai/opengpts#:~:text=The%20three%20different%20architectures%20supported,are%20assistants%2C%20RAG%2C%20and%20chatbots)):

- **Assistant**（エージェント型） – 複数のツールを好きなだけ持たせることができ、LLM（GPT-3.5/4やClaude等の高性能モデル推奨）が**どのツールをいつ使うか自律判断**しながら回答します ([GitHub - langchain-ai/opengpts](https://github.com/langchain-ai/opengpts#:~:text=Assistants))。ReAct形式でループ処理を行い、必要に応じ何度でもツール（計算やウェブ検索、ベクトル検索など）を呼び出して最終回答を導きます ([GitHub - langchain-ai/opengpts](https://github.com/langchain-ai/opengpts#:~:text=Second%2C%20you%20choose%20the%20tools,choose%20however%20many%20you%20want))。柔軟性が非常に高い反面、モデルの性能に大きく依存し、思考ミスやツールの無駄呼び出しが発生しうるため信頼性確保が課題です ([GitHub - langchain-ai/opengpts](https://github.com/langchain-ai/opengpts#:~:text=The%20cognitive%20architecture%20can%20then,and%20it%20finishes%20the%20loop)) ([GitHub - langchain-ai/opengpts](https://github.com/langchain-ai/opengpts#:~:text=Image))。

- **RAG**（RAGBot） – **Retrieval Augmented Generation**に特化したエージェントで、ユーザ質問ごとに必ず一度関連ドキュメント検索を行い、その結果をシステムメッセージ（プロンプト）に含めてLLMから回答を得るシンプルなフローです ([GitHub - langchain-ai/opengpts](https://github.com/langchain-ai/opengpts#:~:text=We%20added%20RAGBot%20,model%20so%20it%20can%20respond))。Assistantに比べ決まった手順で動作するため安定性が高く、オープンソースの中小規模モデルでも動かしやすい利点があります ([GitHub - langchain-ai/opengpts](https://github.com/langchain-ai/opengpts#:~:text=Compared%20to%20assistants%2C%20it%20is,to%20look%20things%20up%20again)) ([GitHub - langchain-ai/opengpts](https://github.com/langchain-ai/opengpts#:~:text=First%2C%20because%20it%20is%20simpler,it%20can%20use%20external%20knowledge))。ただし毎回検索を行うため無関係な雑談には向きません。また一度の検索結果で回答するため、もし見つからない場合は誤答につながる点は注意が必要です ([GitHub - langchain-ai/opengpts](https://github.com/langchain-ai/opengpts#:~:text=Compared%20to%20assistants%2C%20it%20is,to%20look%20things%20up%20again))。

- **Chatbot**（スタンドアロン会話型） – **外部ツールや知識ベースを使わず**、与えたシステムメッセージ（キャラクター設定など）とユーザからのチャット履歴だけで応答する最も単純なモードです ([GitHub - langchain-ai/opengpts](https://github.com/langchain-ai/opengpts#:~:text=ChatBot))。例えば「親切なアシスタント」や特定キャラクターになりきったチャットなど、純粋な対話エージェントとして機能します。外部知識が無いため質問への正確な回答には限界がありますが、創造的な会話や個性ある応答には十分実用的です ([GitHub - langchain-ai/opengpts](https://github.com/langchain-ai/opengpts#:~:text=ChatBot))。

OpenGPTsでは上記のように**ユースケースに応じた認知アーキテクチャ**を選べる点が特徴で、設定ファイルやコードを通じてカスタムのアーキテクチャを定義することも可能です ([GitHub - langchain-ai/opengpts](https://github.com/langchain-ai/opengpts#:~:text=Cognitive%20Architecture)) ([GitHub - langchain-ai/opengpts](https://github.com/langchain-ai/opengpts#:~:text=This%20refers%20to%20the%20logic,them%20or%20add%20your%20own))。Docker Composeによるワンクリックデプロイに対応しており、Postgresでのデータ永続化や認証機構も内蔵されています。まさに**包括的なLLMアプリ開発基盤**と言えるプロジェクトで、RAG検索＋エージェント＋チャットボットのあらゆる要素を網羅した最新の実装例です。



